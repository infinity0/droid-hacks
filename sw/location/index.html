<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Free and privacy-respecting location providers | Android FOSS+H hacks</title>
<link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/html4css1.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/colorbox.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://infinity0.github.io/droid-hacks/sw/location/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Ximin Luo">
<meta property="og:site_name" content="Android FOSS+H hacks">
<meta property="og:title" content="Free and privacy-respecting location providers">
<meta property="og:url" content="https://infinity0.github.io/droid-hacks/sw/location/">
<meta property="og:description" content="Background
Currently, Android phones determine location by using GPS, as well as from
nearby cell tower and WiFi stations. GPS is accurate and privacy-preserving,
but takes a while to lock onto your p">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-12-05T00:00:00Z">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://infinity0.github.io/droid-hacks/">

                <span id="blog-title">Android FOSS+H hacks</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" role="navigation" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../listings/">Code</a>
                </li>
<li>
<a href="../../categories/">Tags</a>
                </li>
<li>
<a href="../../rss.xml">RSS feed</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.rst" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text storypage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Free and privacy-respecting location providers</a></h1>

        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="section" id="background">
<h2>Background</h2>
<p>Currently, Android phones determine location by using GPS, as well as from
nearby cell tower and WiFi stations. GPS is accurate and privacy-preserving,
but takes a while to lock onto your position. The other two methods can give
you a rough idea of your location more quickly. However, they involve querying
remote proprietary databases that tell you which cell towers and WiFi stations
are near which locations. This reveals your location to the database provider,
as well as anyone that can read or break this communication.</p>
<p>In Android, that is handled by <strong>Google Play Services</strong> (GMS). In our
<a class="reference external" href="../../setup-enc-cm/">basic setup</a>, we mentioned that we don't need this. It is
proprietary software and makes you economically dependent on a centralized
third party, and getting rid of such software is the aim of our game.</p>
<p>Instead, we use alternative FOSS to provide the equivalent service. However,
here you download the entire database periodically and do the lookups locally,
so that no remote parties to find out your location. As an added bonus, your
GPS will also be able to get a lock much more quickly, based on this data.</p>
<p>Yes, your mobile carrier can still determine your location, since they know
which cell towers you're connecting to. Given enough data, this will eventually
de-anonymise you even if you got a burner SIM card. However, the other benefits
mentioned above still remain. Also, it prepares the way (and is a necessary
pre-requisite) for eventually having fully location-private mobile networks in
the future. (More generally, if one needs to do A and B to achieve T, and doing
A is not feasible right now, it does not mean that doing B is pointless.)</p>
</div>
<div class="section" id="instructions">
<h2>Instructions</h2>
<p>The steps are very simple but it makes your phone GPS so much more usable that
it deserves its own page:</p>
<ul class="simple">
<li>Follow (1) the installation instructions at <a class="reference external" href="https://lineage.microg.org/">LineagoOS for microG</a> including
(2) install SU for root access and (3) add the <a class="reference external" href="https://microg.org/fdroid.html">microG Fdroid repo</a>. If you
choose to enable the MozillaNlpBackend and NominatimNlpBackend, you should
probably also follow the instructions in <a class="reference external" href="../firewall/">Enforce internet access through Tor</a>.</li>
<li>Install <a class="reference external" href="https://f-droid.org/repository/browse/?fdid=org.fitchfamily.android.gmslocation">LocalGsmNlpBackend</a>, which lets you download global databases for
cell tower locations, and query them later when your phone asks for location.
We also encourage you to install other programs that let you contribute back
to these public and open databases. (TODO: add some specific suggestions)</li>
<li>At the time of writing, there are no downloadable global databases for WiFi
station locations, but there is <a class="reference external" href="https://f-droid.org/repository/browse/?fdid=org.fitchfamily.android.wifi_backend">LocalWifiNlpBackend</a>. This remembers the
location of nearby WiFi stations (using GPS) so that it will lock quicker the
next time you're nearby. This can be useful if you go to a new place for a
few days - after the first day or so, your GPS should lock quickly again. But
you should switch it off when you are in a familiar place, to save battery.</li>
</ul>
<p>After installing these, restart your phone, then follow further instructions
for <em>µg UnifiedNlp</em> which will take you through configuration steps for the
other programs as well.</p>
<div class="section" id="make-sure-it-works">
<h3>Make sure it works</h3>
<p>Install "GPSTest", "SatStat", and "HereGPS". Currently it's a bit stupid but
you do need to install all of them for the following functionality:</p>
<ul class="simple">
<li>GPSTest has a "clear AGPS" option</li>
<li>SatStat has a "reload APGS" option</li>
<li>HereGPS shows you <em>when</em> each source (Network, GPS) was last updated.</li>
</ul>
<p>Annoyingly, I haven't found an app that contains all three features. &gt;:[</p>
<p><tt class="docutils literal">gps.conf</tt> is the important thing. This file is located in different paths
depending on your phone, use <tt class="docutils literal">adb shell</tt> and <tt class="docutils literal">find(1)</tt> to find it yourself.
We are now going to edit it, since the stock one provided by LineageOS is not
very suitable for many phones. You may need to run something like <tt class="docutils literal">mount <span class="pre">-o</span>
remount,rw /vendor</tt> as root in adb if the partition containing <tt class="docutils literal">gps.conf</tt> is
mounted read-only.</p>
<p>There is some good information about the file contents here:</p>
<p><a class="reference external" href="https://rootzwiki.com/topic/28989-the-end-all-be-all-guide-to-your-gps/">https://rootzwiki.com/topic/28989-the-end-all-be-all-guide-to-your-gps/</a></p>
<p>Read the whole thread. Then to get you started, download one of these <a class="reference external" href="https://app.box.com/s/w57s1v1n3hie7l5lk28i">custom
gps.conf</a> files. These are pretty good but still contain some mistakes, so
edit it further after downloading it, based on the above thread. For example, I
had to remove extraneous NTP servers and placeholder "FQDN" entries for
<tt class="docutils literal">SUPL_HOST</tt> and <tt class="docutils literal">SUPL_TLS_HOST</tt>. I also had to download the correct root
cert for the <tt class="docutils literal">SUPL_TLS_HOST</tt>:</p>
<pre class="literal-block">
$ openssl s_client -connect $SUPL_TLS_HOST:$SUPL_SECURE_PORT -prexit -showcerts
</pre>
<p>It will output a bunch of stuff. Only proceed if near the bottom you see
"Verify return code: 0 (ok)". Then, find the root certificate (probably the
last one that was output), paste it into a new file <tt class="docutils literal">SuplRootCert.pem</tt>, then
run:</p>
<pre class="literal-block">
$ openssl x509 -in SuplRootCert.pem -outform DER -out SuplRootCert
</pre>
<p>You can then copy <tt class="docutils literal">SuplRootCert</tt> into your phone. Put it next to <tt class="docutils literal">gps.conf</tt>
and then set the entry for <tt class="docutils literal">SUPL_TLS_CERT</tt> to point to it.</p>
<p>When you're all done, restart your phone and go somewhere with good GPS signal
(i.e. outside or near a window) and good cell signal. Then, use the apps I
mentioned above to make sure everything's working correctly. You might have to
dick around a bit, but hopefully the <tt class="docutils literal">gps.conf</tt> tips helped a lot.</p>
</div>
<div class="section" id="next-steps">
<h3>Next steps</h3>
<p>To replace <strong>Google Maps</strong>, use <a class="reference external" href="https://f-droid.org/repository/browse/?fdid=net.osmand.plus">OsmAnd+</a>. It has completely offline vector
maps, that are incredibly detailed, with public transport and address data, as
well as offline navigation. The main downside is that redrawing the map when
you move or resize takes about 2-3 seconds, but you get used to it quickly.</p>
<p>Finally, don't forget to update your data every once in a while. Of the apps
mentioned on this page, that is <em>LocalGsmNlpBackend</em> which you access <em>via</em> the
<em>microG Services Core</em> app, and <em>OsmAnd~</em>. At present, neither of these apps
will alert you about out-of-date data, but in practice this hasn't been a
problem for me. Just remember to do it every month, or longer is probably fine
too - and you can even set a <a class="reference external" href="../owndata/">calendar event</a> for that. :)</p>
</div>
</div>
</div>
    </div>
    

</article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2019         <a href="mailto:infinity0@pwned.gg">Ximin Luo</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../../assets/js/jquery.min.js"></script><script src="../../assets/js/bootstrap.min.js"></script><script src="../../assets/js/moment-with-locales.min.js"></script><script src="../../assets/js/fancydates.js"></script><script src="../../assets/js/jquery.colorbox-min.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
